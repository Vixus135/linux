# Упражнение 1: Система обработки сообщений с использованием условных переменных
### Задание
Пусть есть процесс, один или несколько, которые генерируют задачи. Делают они это
через неопределённые промежутки времени. И есть один процесс, который обрабатывает
эти задачи. Например, есть поток, который занимается рассылкой писем, и несколько
потоков, которые кидают сообщения к отправке. Каким образом реализовать поток,
занимающийся обработкой сообщений?

## Логика программы
Программа реализует паттерн "Производитель-Потребитель" с использованием механизмов
синхронизации POSIX threads. Система состоит из двух типов потоков:

1. Поток-отправитель (производитель) - генерирует сообщения через случайные
   промежутки времени (1-3 секунды) и помещает их в общую очередь.

2. Поток-обработчик (потребитель) - ожидает поступления сообщений и обрабатывает
   их по одному.

Для синхронизации используются:
- Мьютекс (`mu`), который защищает доступ к общей переменной `mess_cnt` (счетчик сообщений)
- Условная переменная (`cond`), которая позволяет потоку-обработчику ожидать
  появления новых сообщений без потребления процессорного времени

## Почему программа работает
Программа работает благодаря правильной синхронизации доступа к общим
ресурсам:

1. Мьютекс гарантирует, что только один поток может изменять счетчик сообщений
   в любой момент времени, предотвращая состояние гонки

2. Условная переменная позволяет потоку-обработчику переходить в режим ожидания
   когда нет сообщений, экономя тем саммым ресурсы процессора

3. При поступлении нового сообщения поток-отправитель
   отправляет сигнал через `pthread_cond_signal()`, который будит поток-обработчик

4. Использование цикла `while` при проверке условия защищает от ложных пробуждений - даже если поток проснется без получения сигнала, он проверит условие повторно

5. Функция `pthread_cond_wait()` автоматически разблокирует мьютекс при входе в
   ожидание и автоматически блокирует его снова при пробуждении, что гарантирует
   целостность данных

Последовательность работы:
- Обработчик блокирует мьютекс и проверяет наличие сообщений
- Если сообщений нет, переходит в ожидание (автоматически разблокируя мьютекс)
- Если сообщение есть, то отправитель блокирует мьютекс, добавляет сообщение и отправляет сигнал
- Обработчик просыпается (автоматически блокирует мьютекс) и обрабатывает сообщение

## Структура проекта
Изначально программа была реализована в одном файле `messa.c`, но для лучшего понимания 
и читаемости кода (я надеюсь) была разделена на два файла:

1. `main.c`, содержащий основную логику программы:
   - Создание и управление потоками
   - Синхронизация примитивов
   - Координация работы всей системы
2. `funcs.c`, содержащий вспомогательные функции:
   - `mess_hand()` - функция потока-обработчика
   - `mess_send()` - функция потока-отправителя
   - Дополнительные утилиты для работы с сообщениями

## Компиляция и запуск
Для компиляции программы используйте команду:
```bash
make
```
                                                   
Для запуска:
```bash
./message_system
```

Примечание: программа работает бесконечно, для завершения нажмите Ctrl+C.
